<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compliance Audit Report - {{ticket.id}}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            font-size: 12px;
        }
        
        .header {
            background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
            color: white;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .compliance-status {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .compliance-compliant {
            background: #ecfdf5;
            border: 3px solid #10b981;
            color: #047857;
        }
        
        .compliance-at-risk {
            background: #fef3c7;
            border: 3px solid #f59e0b;
            color: #92400e;
        }
        
        .compliance-non-compliant {
            background: #fef2f2;
            border: 3px solid #ef4444;
            color: #dc2626;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .section {
            margin-bottom: 30px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .section-header {
            background: #f8fafc;
            padding: 15px 20px;
            border-bottom: 1px solid #e5e7eb;
            font-weight: bold;
            font-size: 16px;
            color: #374151;
        }
        
        .section-content {
            padding: 20px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .info-item {
            margin-bottom: 10px;
        }
        
        .info-label {
            font-weight: bold;
            color: #6b7280;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 3px;
        }
        
        .info-value {
            color: #111827;
            font-size: 13px;
        }
        
        .audit-entry {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .audit-header {
            background: #f3f4f6;
            padding: 10px 15px;
            font-weight: bold;
            font-size: 13px;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .audit-content {
            padding: 15px;
        }
        
        .legislation-ref {
            background: #ede9fe;
            border: 1px solid #8b5cf6;
            border-radius: 4px;
            padding: 8px 12px;
            margin: 5px 5px 5px 0;
            display: inline-block;
            font-size: 11px;
            font-weight: bold;
            color: #5b21b6;
        }
        
        .workflow-step {
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8fafc;
        }
        
        .workflow-step.completed {
            border-left-color: #10b981;
        }
        
        .workflow-step.pending {
            border-left-color: #f59e0b;
        }
        
        .workflow-step.escalated {
            border-left-color: #ef4444;
        }
        
        .participation-event {
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .participation-attended {
            background: #f0fdf4;
            border-color: #22c55e;
        }
        
        .participation-no-show {
            background: #fef2f2;
            border-color: #ef4444;
        }
        
        .participation-refused {
            background: #fef2f2;
            border-color: #dc2626;
        }
        
        .participation-rescheduled {
            background: #fef3c7;
            border-color: #f59e0b;
        }
        
        .generated-letter {
            background: #f0f9ff;
            border: 1px solid #3b82f6;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .letter-header {
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 8px;
        }
        
        .deadline-warning {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-weight: bold;
            color: #92400e;
        }
        
        .critical-warning {
            background: #fef2f2;
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-weight: bold;
            color: #dc2626;
        }
        
        .footer {
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            text-align: center;
            color: #6b7280;
            font-size: 11px;
        }
        
        .legal-notice {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-size: 11px;
            color: #374151;
        }
        
        @media print {
            .section {
                page-break-inside: avoid;
            }
            
            .header {
                page-break-after: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Compliance Audit Report</h1>
        <div class="subtitle">Legal Compliance & Audit Trail Documentation</div>
    </div>
    
    <div class="container">
        <!-- Compliance Status -->
        <div class="compliance-status {{#eq ticket.complianceStatus "compliant"}}compliance-compliant{{/eq}}{{#eq ticket.complianceStatus "at_risk"}}compliance-at-risk{{/eq}}{{#eq ticket.complianceStatus "non_compliant"}}compliance-non-compliant{{/eq}}">
            {{#eq ticket.complianceStatus "compliant"}}Fully Compliant{{/eq}}
            {{#eq ticket.complianceStatus "at_risk"}}Compliance At Risk{{/eq}}
            {{#eq ticket.complianceStatus "non_compliant"}}Non-Compliant{{/eq}}
        </div>

        <!-- Case Overview -->
        <div class="section">
            <div class="section-header">Case Overview</div>
            <div class="section-content">
                <div class="info-grid">
                    <div>
                        <div class="info-item">
                            <div class="info-label">Case ID</div>
                            <div class="info-value">{{ticket.id}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Worker</div>
                            <div class="info-value">{{worker.firstName}} {{worker.lastName}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Case Type</div>
                            <div class="info-value">{{capitalize ticket.caseType}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Jurisdiction</div>
                            <div class="info-value">{{ticket.workplaceJurisdiction}}</div>
                        </div>
                    </div>
                    <div>
                        <div class="info-item">
                            <div class="info-label">Current RTW Step</div>
                            <div class="info-value">{{ticket.rtwStep}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Last Participation</div>
                            <div class="info-value">{{#if ticket.lastParticipationDate}}{{formatDate ticket.lastParticipationDate}}{{else}}No participation recorded{{/if}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Next Deadline</div>
                            <div class="info-value">{{#if ticket.nextDeadlineDate}}{{formatDate ticket.nextDeadlineDate}} ({{ticket.nextDeadlineType}}){{else}}No deadlines pending{{/if}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Audit Date</div>
                            <div class="info-value">{{formatDate generatedAt}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Critical Warnings -->
        {{#if ticket.nextDeadlineDate}}
        {{#if (eq ticket.complianceStatus "at_risk")}}
        <div class="deadline-warning">
            WARNING: Upcoming deadline for {{ticket.nextDeadlineType}} on {{formatDate ticket.nextDeadlineDate}}. 
            Immediate action required to maintain compliance.
        </div>
        {{/if}}
        {{#if (eq ticket.complianceStatus "non_compliant")}}
        <div class="critical-warning">
            CRITICAL: Case is non-compliant. Immediate intervention required. 
            Deadline {{ticket.nextDeadlineType}} was due {{formatDate ticket.nextDeadlineDate}}.
        </div>
        {{/if}}
        {{/if}}

        <!-- Workflow Steps Progress -->
        {{#if workflowSteps}}
        <div class="section">
            <div class="section-header">RTW Workflow Progress</div>
            <div class="section-content">
                {{#each workflowSteps}}
                <div class="workflow-step {{status}}">
                    <div class="info-grid">
                        <div>
                            <div class="info-item">
                                <div class="info-label">Step</div>
                                <div class="info-value">{{stepId}}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Status</div>
                                <div class="info-value">{{capitalize status}}</div>
                            </div>
                        </div>
                        <div>
                            {{#if startDate}}
                            <div class="info-item">
                                <div class="info-label">Start Date</div>
                                <div class="info-value">{{formatDate startDate}}</div>
                            </div>
                            {{/if}}
                            {{#if deadlineDate}}
                            <div class="info-item">
                                <div class="info-label">Deadline</div>
                                <div class="info-value">{{formatDate deadlineDate}}</div>
                            </div>
                            {{/if}}
                            {{#if completedDate}}
                            <div class="info-item">
                                <div class="info-label">Completed</div>
                                <div class="info-value">{{formatDate completedDate}}</div>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    
                    {{#if legislationRefs}}
                    <div class="info-item">
                        <div class="info-label">Legislation References</div>
                        <div>
                            {{#each legislationRefs}}
                            <span class="legislation-ref">{{source}} {{id}}: {{title}}</span>
                            {{/each}}
                        </div>
                    </div>
                    {{/if}}
                    
                    {{#if notes}}
                    <div class="info-item">
                        <div class="info-label">Notes</div>
                        <div class="info-value">{{notes}}</div>
                    </div>
                    {{/if}}
                    
                    {{#if escalationReason}}
                    <div class="info-item">
                        <div class="info-label">Escalation Reason</div>
                        <div class="info-value">{{escalationReason}}</div>
                    </div>
                    {{/if}}
                </div>
                {{/each}}
            </div>
        </div>
        {{/if}}

        <!-- Worker Participation Events -->
        {{#if participationEvents}}
        <div class="section">
            <div class="section-header">Worker Participation History</div>
            <div class="section-content">
                {{#each participationEvents}}
                <div class="participation-event participation-{{participationStatus}}">
                    <div class="info-grid">
                        <div>
                            <div class="info-item">
                                <div class="info-label">Event Type</div>
                                <div class="info-value">{{capitalize eventType}}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Event Date</div>
                                <div class="info-value">{{formatDate eventDate}}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Participation</div>
                                <div class="info-value">{{capitalize participationStatus}}</div>
                            </div>
                        </div>
                        <div>
                            {{#if scheduledDate}}
                            <div class="info-item">
                                <div class="info-label">Originally Scheduled</div>
                                <div class="info-value">{{formatDate scheduledDate}}</div>
                            </div>
                            {{/if}}
                            {{#if noticeGivenDate}}
                            <div class="info-item">
                                <div class="info-label">Notice Given</div>
                                <div class="info-value">{{formatDate noticeGivenDate}} ({{noticePeriodDays}} days)</div>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    
                    {{#if reasonForNonParticipation}}
                    <div class="info-item">
                        <div class="info-label">Reason for Non-Participation</div>
                        <div class="info-value">{{reasonForNonParticipation}}</div>
                    </div>
                    {{/if}}
                    
                    {{#if legislationBasis}}
                    <div class="info-item">
                        <div class="info-label">Legislation Basis</div>
                        <div>
                            {{#each legislationBasis}}
                            <span class="legislation-ref">{{source}} {{id}}: {{title}}</span>
                            {{/each}}
                        </div>
                    </div>
                    {{/if}}
                    
                    {{#if complianceNotes}}
                    <div class="info-item">
                        <div class="info-label">Compliance Notes</div>
                        <div class="info-value">{{complianceNotes}}</div>
                    </div>
                    {{/if}}
                </div>
                {{/each}}
            </div>
        </div>
        {{/if}}

        <!-- Generated Letters & Communications -->
        {{#if generatedLetters}}
        <div class="section">
            <div class="section-header">Generated Letters & Communications</div>
            <div class="section-content">
                {{#each generatedLetters}}
                <div class="generated-letter">
                    <div class="letter-header">{{subject}}</div>
                    <div class="info-grid">
                        <div>
                            <div class="info-item">
                                <div class="info-label">Recipient</div>
                                <div class="info-value">{{recipientName}} ({{capitalize recipientType}})</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Status</div>
                                <div class="info-value">{{capitalize status}}</div>
                            </div>
                        </div>
                        <div>
                            <div class="info-item">
                                <div class="info-label">Generated</div>
                                <div class="info-value">{{formatDate createdAt}}</div>
                            </div>
                            {{#if sentAt}}
                            <div class="info-item">
                                <div class="info-label">Sent</div>
                                <div class="info-value">{{formatDate sentAt}}</div>
                            </div>
                            {{/if}}
                            {{#if deadlineDate}}
                            <div class="info-item">
                                <div class="info-label">Deadline Given</div>
                                <div class="info-value">{{formatDate deadlineDate}}</div>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    
                    {{#if legislationRefs}}
                    <div class="info-item">
                        <div class="info-label">Legislation References</div>
                        <div>
                            {{#each legislationRefs}}
                            <span class="legislation-ref">{{source}} {{id}}: {{title}}</span>
                            {{/each}}
                        </div>
                    </div>
                    {{/if}}
                </div>
                {{/each}}
            </div>
        </div>
        {{/if}}

        <!-- Compliance Audit Trail -->
        {{#if auditTrail}}
        <div class="section">
            <div class="section-header">Detailed Audit Trail</div>
            <div class="section-content">
                {{#each auditTrail}}
                <div class="audit-entry">
                    <div class="audit-header">
                        {{formatDateTime createdAt}} - {{action}} by {{actorName}}
                    </div>
                    <div class="audit-content">
                        <div class="info-grid">
                            <div>
                                <div class="info-item">
                                    <div class="info-label">Action</div>
                                    <div class="info-value">{{action}}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Actor</div>
                                    <div class="info-value">{{actorName}} ({{actorId}})</div>
                                </div>
                            </div>
                            <div>
                                <div class="info-item">
                                    <div class="info-label">Result</div>
                                    <div class="info-value">{{capitalize result}}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Source Version</div>
                                    <div class="info-value">{{sourceVersion}}</div>
                                </div>
                            </div>
                        </div>
                        
                        {{#if legislationRefs}}
                        <div class="info-item">
                            <div class="info-label">Legislation References</div>
                            <div>
                                {{#each legislationRefs}}
                                <span class="legislation-ref">{{source}} {{id}}: {{title}}</span>
                                {{/each}}
                            </div>
                        </div>
                        {{/if}}
                        
                        {{#if templateUsed}}
                        <div class="info-item">
                            <div class="info-label">Template Used</div>
                            <div class="info-value">{{templateUsed}}</div>
                        </div>
                        {{/if}}
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
        {{/if}}

        <!-- Legal Notice -->
        <div class="legal-notice">
            <strong>Legal Compliance Notice:</strong> This audit report is prepared for legal compliance purposes and may be subject to discovery in legal proceedings. All actions documented in this report are based on current Victorian WorkCover legislation and regulations. This document provides a complete audit trail for compliance defense purposes. Timestamps and checksums ensure data integrity. All information should be treated as legally privileged and confidential.
        </div>
    </div>

    <div class="footer">
        <p>Compliance audit generated on {{formatDateTime generatedAt}} by {{generatedBy}}</p>
        <p>GPNet RTW Complex Claims Management System - Legal Compliance Document</p>
        <p>Case ID: {{ticket.id}} | Audit Version: 1.0 | System Version: {{#if auditTrail.[0].sourceVersion}}{{auditTrail.[0].sourceVersion}}{{else}}Current{{/if}}</p>
    </div>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workplace Injury Report - {{worker.firstName}} {{worker.lastName}}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            font-size: 12px;
        }
        
        .header {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            color: white;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .urgent-notice {
            background: #fef2f2;
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 30px;
            text-align: center;
            color: #dc2626;
            font-weight: bold;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .section {
            margin-bottom: 30px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .section-header {
            background: #f8fafc;
            padding: 15px 20px;
            border-bottom: 1px solid #e5e7eb;
            font-weight: bold;
            font-size: 16px;
            color: #374151;
        }
        
        .section-content {
            padding: 20px;
        }
        
        .severity-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
        }
        
        .severity-minor {
            background-color: #10b981;
        }
        
        .severity-moderate {
            background-color: #f59e0b;
        }
        
        .severity-serious {
            background-color: #ef4444;
        }
        
        .severity-major {
            background-color: #7c2d12;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .info-item {
            margin-bottom: 10px;
        }
        
        .info-label {
            font-weight: bold;
            color: #6b7280;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 3px;
        }
        
        .info-value {
            color: #111827;
            font-size: 13px;
        }
        
        .incident-details {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .body-parts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .body-part-tag {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            border-radius: 6px;
            padding: 8px 12px;
            text-align: center;
            font-size: 11px;
            font-weight: bold;
            color: #1e40af;
        }
        
        .timeline-item {
            border-left: 3px solid #3b82f6;
            padding-left: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -7px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #3b82f6;
        }
        
        .timeline-time {
            font-weight: bold;
            color: #3b82f6;
            font-size: 12px;
        }
        
        .timeline-content {
            margin-top: 5px;
            color: #374151;
        }
        
        .stakeholder-item {
            padding: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 10px;
            background: #fafafa;
        }
        
        .rtw-status {
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        
        .rtw-approved {
            background: #ecfdf5;
            border: 2px solid #10b981;
            color: #047857;
        }
        
        .rtw-pending {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            color: #92400e;
        }
        
        .rtw-restrictions {
            background: #fef2f2;
            border: 2px solid #ef4444;
            color: #dc2626;
        }
        
        .footer {
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            text-align: center;
            color: #6b7280;
            font-size: 11px;
        }
        
        .legal-notice {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-size: 11px;
            color: #374151;
        }
        
        @media print {
            .section {
                page-break-inside: avoid;
            }
            
            .header {
                page-break-after: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Workplace Injury Report</h1>
        <div class="subtitle">Incident Documentation & Analysis</div>
    </div>
    
    <div class="container">
        {{#if (eq injury.severity "serious")}}
        <div class="urgent-notice">
            SERIOUS INJURY REPORTED - IMMEDIATE ATTENTION REQUIRED
        </div>
        {{/if}}
        
        {{#if (eq injury.severity "major")}}
        <div class="urgent-notice">
            MAJOR INJURY REPORTED - CRITICAL INCIDENT
        </div>
        {{/if}}

        <!-- Incident Overview -->
        <div class="section">
            <div class="section-header">Incident Overview</div>
            <div class="section-content">
                <div class="info-grid">
                    <div>
                        <div class="info-item">
                            <div class="info-label">Case ID</div>
                            <div class="info-value">{{ticket.id}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Incident Date</div>
                            <div class="info-value">{{formatDate injury.incidentDate}} {{#if injury.incidentTime}}at {{injury.incidentTime}}{{/if}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Location</div>
                            <div class="info-value">{{injury.location}}</div>
                        </div>
                    </div>
                    <div>
                        <div class="info-item">
                            <div class="info-label">Injury Type</div>
                            <div class="info-value">{{capitalize injury.injuryType}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Severity Level</div>
                            <div class="info-value">
                                <span class="severity-badge severity-{{injury.severity}}">{{capitalize injury.severity}}</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Report Date</div>
                            <div class="info-value">{{formatDate generatedAt}}</div>
                        </div>
                    </div>
                </div>
                
                <div class="incident-details">
                    <div class="info-label">Incident Description</div>
                    <div class="info-value">{{injury.description}}</div>
                </div>
            </div>
        </div>

        <!-- Injured Worker Information -->
        <div class="section">
            <div class="section-header">Injured Worker Information</div>
            <div class="section-content">
                <div class="info-grid">
                    <div>
                        <div class="info-item">
                            <div class="info-label">Full Name</div>
                            <div class="info-value">{{worker.firstName}} {{worker.lastName}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Employee ID</div>
                            <div class="info-value">{{#if formSubmission.rawData.employeeId}}{{formSubmission.rawData.employeeId}}{{else}}Not specified{{/if}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Department</div>
                            <div class="info-value">{{#if formSubmission.rawData.department}}{{formSubmission.rawData.department}}{{else}}Not specified{{/if}}</div>
                        </div>
                    </div>
                    <div>
                        <div class="info-item">
                            <div class="info-label">Position</div>
                            <div class="info-value">{{#if formSubmission.rawData.position}}{{formSubmission.rawData.position}}{{else}}{{worker.roleApplied}}{{/if}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Supervisor</div>
                            <div class="info-value">{{#if formSubmission.rawData.supervisor}}{{formSubmission.rawData.supervisor}}{{else}}Not specified{{/if}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Contact</div>
                            <div class="info-value">{{worker.email}} | {{worker.phone}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Injury Details -->
        <div class="section">
            <div class="section-header">Injury Details</div>
            <div class="section-content">
                {{#if injury.bodyPartsAffected}}
                <div class="info-item">
                    <div class="info-label">Body Parts Affected</div>
                    <div class="body-parts-grid">
                        {{#each injury.bodyPartsAffected}}
                        <div class="body-part-tag">{{this}}</div>
                        {{/each}}
                    </div>
                </div>
                {{/if}}
                
                <div class="info-grid">
                    <div>
                        <div class="info-item">
                            <div class="info-label">Time Off Work Required</div>
                            <div class="info-value">{{#if injury.timeOffWork}}Yes{{else}}No{{/if}}</div>
                        </div>
                        {{#if injury.estimatedRecovery}}
                        <div class="info-item">
                            <div class="info-label">Estimated Recovery Time</div>
                            <div class="info-value">{{injury.estimatedRecovery}}</div>
                        </div>
                        {{/if}}
                    </div>
                    <div>
                        {{#if injury.witnessDetails}}
                        <div class="info-item">
                            <div class="info-label">Witness Information</div>
                            <div class="info-value">{{injury.witnessDetails}}</div>
                        </div>
                        {{/if}}
                    </div>
                </div>
                
                {{#if injury.medicalTreatment}}
                <div class="info-item">
                    <div class="info-label">Medical Treatment Provided</div>
                    <div class="info-value">{{injury.medicalTreatment}}</div>
                </div>
                {{/if}}
                
                {{#if injury.immediateAction}}
                <div class="info-item">
                    <div class="info-label">Immediate Action Taken</div>
                    <div class="info-value">{{injury.immediateAction}}</div>
                </div>
                {{/if}}
            </div>
        </div>

        <!-- Timeline of Events -->
        <div class="section">
            <div class="section-header">Timeline of Events</div>
            <div class="section-content">
                <div class="timeline-item">
                    <div class="timeline-time">{{formatDate injury.incidentDate}} {{injury.incidentTime}}</div>
                    <div class="timeline-content">Incident occurred at {{injury.location}}</div>
                </div>
                
                {{#if injury.immediateAction}}
                <div class="timeline-item">
                    <div class="timeline-time">Immediately after incident</div>
                    <div class="timeline-content">{{injury.immediateAction}}</div>
                </div>
                {{/if}}
                
                {{#if injury.medicalTreatment}}
                <div class="timeline-item">
                    <div class="timeline-time">Medical response</div>
                    <div class="timeline-content">{{injury.medicalTreatment}}</div>
                </div>
                {{/if}}
                
                <div class="timeline-item">
                    <div class="timeline-time">{{formatDate ticket.createdAt}}</div>
                    <div class="timeline-content">Case created in GPNet system</div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-time">{{formatDate generatedAt}}</div>
                    <div class="timeline-content">Injury report generated</div>
                </div>
            </div>
        </div>

        <!-- Return to Work Assessment -->
        {{#if rtwPlan}}
        <div class="section">
            <div class="section-header">Return to Work Plan</div>
            <div class="section-content">
                <div class="rtw-status {{#eq rtwPlan.status "approved"}}rtw-approved{{/eq}}{{#eq rtwPlan.status "pending_approval"}}rtw-pending{{/eq}}{{#if rtwPlan.restrictions}}rtw-restrictions{{/if}}">
                    <h3>{{rtwPlan.title}}</h3>
                    <p>Status: {{capitalize rtwPlan.status}}</p>
                    {{#if rtwPlan.targetReturnDate}}
                    <p>Target Return Date: {{formatDate rtwPlan.targetReturnDate}}</p>
                    {{/if}}
                </div>
                
                {{#if rtwPlan.restrictions}}
                <div class="info-item">
                    <div class="info-label">Work Restrictions</div>
                    <ul>
                        {{#each rtwPlan.restrictions}}
                        <li>{{this}}</li>
                        {{/each}}
                    </ul>
                </div>
                {{/if}}
                
                {{#if rtwPlan.modifiedDuties}}
                <div class="info-item">
                    <div class="info-label">Modified Duties</div>
                    <ul>
                        {{#each rtwPlan.modifiedDuties}}
                        <li>{{this}}</li>
                        {{/each}}
                    </ul>
                </div>
                {{/if}}
                
                {{#if rtwPlan.doctorNotes}}
                <div class="info-item">
                    <div class="info-label">Doctor Notes</div>
                    <div class="info-value">{{rtwPlan.doctorNotes}}</div>
                </div>
                {{/if}}
            </div>
        </div>
        {{/if}}

        <!-- Work Capacity Assessment -->
        {{#if formSubmission.rawData.canReturnToWork}}
        <div class="section">
            <div class="section-header">Work Capacity Assessment</div>
            <div class="section-content">
                <div class="info-item">
                    <div class="info-label">Can Return to Work</div>
                    <div class="info-value">{{capitalize formSubmission.rawData.canReturnToWork}}</div>
                </div>
                
                {{#if formSubmission.rawData.workRestrictions}}
                <div class="info-item">
                    <div class="info-label">Work Restrictions</div>
                    <ul>
                        {{#each formSubmission.rawData.workRestrictions}}
                        <li>{{this}}</li>
                        {{/each}}
                    </ul>
                </div>
                {{/if}}
            </div>
        </div>
        {{/if}}

        <!-- Medical Professionals -->
        {{#if stakeholders}}
        <div class="section">
            <div class="section-header">Medical Professionals Involved</div>
            <div class="section-content">
                {{#each stakeholders}}
                {{#if (eq role "doctor")}}
                <div class="stakeholder-item">
                    <div class="info-grid">
                        <div>
                            <div class="info-item">
                                <div class="info-label">Name</div>
                                <div class="info-value">{{name}}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Organization</div>
                                <div class="info-value">{{organization}}</div>
                            </div>
                        </div>
                        <div>
                            {{#if email}}
                            <div class="info-item">
                                <div class="info-label">Email</div>
                                <div class="info-value">{{email}}</div>
                            </div>
                            {{/if}}
                            {{#if phone}}
                            <div class="info-item">
                                <div class="info-label">Phone</div>
                                <div class="info-value">{{phone}}</div>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    {{#if notes}}
                    <div class="info-item">
                        <div class="info-label">Notes</div>
                        <div class="info-value">{{notes}}</div>
                    </div>
                    {{/if}}
                </div>
                {{/if}}
                {{/each}}
            </div>
        </div>
        {{/if}}

        <!-- Claim Information -->
        {{#if (or ticket.claimType formSubmission.rawData.claimType)}}
        <div class="section">
            <div class="section-header">Claim Information</div>
            <div class="section-content">
                <div class="info-grid">
                    <div>
                        <div class="info-item">
                            <div class="info-label">Claim Type</div>
                            <div class="info-value">{{capitalize (or ticket.claimType formSubmission.rawData.claimType)}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Case Priority</div>
                            <div class="info-value">{{capitalize ticket.priority}}</div>
                        </div>
                    </div>
                    <div>
                        <div class="info-item">
                            <div class="info-label">Jurisdiction</div>
                            <div class="info-value">{{ticket.workplaceJurisdiction}}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Case Status</div>
                            <div class="info-value">{{ticket.status}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{/if}}

        <!-- Legal Notice -->
        <div class="legal-notice">
            <strong>Legal Notice:</strong> This injury report is prepared based on information provided at the time of the incident and subsequent assessments. This document may be subject to discovery in legal proceedings. All information should be treated as confidential and handled in accordance with workplace safety regulations and privacy laws. This report does not constitute medical advice and should not replace professional medical consultation.
        </div>
    </div>

    <div class="footer">
        <p>Report generated on {{formatDateTime generatedAt}} by {{generatedBy}}</p>
        <p>GPNet Workplace Injury Management System - Confidential Document</p>
        <p>Case ID: {{ticket.id}} | Report Version: 1.0</p>
    </div>
</body>
</html>